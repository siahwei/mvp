<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>XHS è‰ç¨¿</title>
  <style>
    :root{
      --bg:#0b0b0f; --card:#14141b; --muted:#9aa0aa; --text:#f2f3f5;
      --chip:#1f202a; --line:#232433; --accent:#ff2d55;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
    .wrap{max-width:420px;margin:0 auto;padding:14px 14px 22px}
    .top{display:flex;align-items:center;gap:10px;padding:6px 0 10px}
    .back{width:34px;height:34px;border-radius:10px;background:var(--card);display:flex;align-items:center;justify-content:center;color:var(--text);opacity:.9}
    .photoRow{display:flex;gap:10px;align-items:center;margin:10px 0 12px}
    .photo{
      width:64px;height:64px;border-radius:14px;overflow:hidden;background:#222;
      flex:0 0 auto;border:1px solid rgba(255,255,255,.06)
    }
    .photo img{width:100%;height:100%;object-fit:cover;display:block}
    .addBtn{
      width:64px;height:64px;border-radius:14px;background:var(--card);
      border:1px dashed rgba(255,255,255,.18);display:flex;align-items:center;justify-content:center;
      color:var(--muted);font-size:28px
    }
    .title{
      width:100%;border:0;outline:0;background:transparent;color:var(--text);
      font-size:18px;font-weight:700;line-height:1.25;margin:6px 0 10px
    }
    .body{
      width:100%;min-height:220px;border:0;outline:0;background:transparent;color:var(--text);
      font-size:15px;line-height:1.5;white-space:pre-wrap;resize:none
    }
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{
      background:var(--chip);border:1px solid rgba(255,255,255,.08);
      padding:8px 10px;border-radius:999px;color:#d7d9de;font-size:13px;
      cursor:pointer;user-select:none
    }
    .chip:active{transform:scale(.98)}
    .row{
      margin-top:14px;border-top:1px solid var(--line);padding-top:10px
    }
    .opt{
      display:flex;align-items:center;justify-content:space-between;
      padding:10px 2px;color:#d7d9de;font-size:14px
    }
    .opt span{color:var(--muted)}
    .bar{
      position:sticky;bottom:0;background:linear-gradient(to top, rgba(11,11,15,1), rgba(11,11,15,.85));
      padding:12px 0 0;margin-top:16px
    }
    .actions{display:flex;gap:10px}
    .btn{
      flex:1;border:0;border-radius:999px;padding:12px 14px;
      font-size:14px;font-weight:700;cursor:pointer
    }
    .btnGhost{background:var(--card);color:var(--text);border:1px solid rgba(255,255,255,.10)}
    .btnAccent{background:var(--accent);color:white}
    .hint{color:var(--muted);font-size:12px;margin:10px 2px 0;line-height:1.4}
    .toast{
      position:fixed;left:50%;transform:translateX(-50%);
      bottom:92px;background:rgba(20,20,27,.95);border:1px solid rgba(255,255,255,.10);
      padding:10px 12px;border-radius:12px;color:var(--text);font-size:13px;
      display:none;max-width:90vw
    }
    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.55);
      display:none;align-items:center;justify-content:center;padding:18px
    }
    .modal{
      width:100%;max-width:380px;background:var(--card);border:1px solid rgba(255,255,255,.10);
      border-radius:18px;padding:14px
    }
    .modal h3{margin:0 0 6px;font-size:16px}
    .modal p{margin:0 0 12px;color:var(--muted);font-size:13px;line-height:1.45}
    .modal .mBtns{display:flex;gap:10px}
    .small{font-size:12px;color:var(--muted);margin-top:8px}
    a{color:inherit}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="back">â†</div>
      <div style="color:var(--muted);font-size:13px;">Chrome</div>
    </div>

    <div class="photoRow">
      <div class="photo"><img id="coverImg" src="https://placehold.co/600x600?text=Cover" alt="cover"/></div>

      <div class="addBtn">+</div>
    </div>

    <input class="title" id="title" value="" placeholder="æ·»åŠ æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰" />

    <textarea class="body" id="body" placeholder="å†™ä¸‹ä½ çš„ç¬”è®°â€¦"></textarea>

    <div class="chips" id="chips"></div>

    <div class="row">
      <div class="opt">ğŸ“ æ ‡è®°åœ°ç‚¹ <span>å¯é€‰</span></div>
      <div class="opt">ğŸ‘ å…¬å¼€å¯è§ <span>é»˜è®¤</span></div>
      <div class="opt">ğŸ§© æ·»åŠ ç»„ä»¶ <span>å¯æ·»åŠ æ–‡ä»¶</span></div>
      <div class="opt">âš™ï¸ é«˜çº§é€‰é¡¹ <span></span></div>
    </div>

    <div class="bar">
      <div class="actions">
        <button class="btn btnGhost" id="btnSaveImg">ä¿å­˜å›¾ç‰‡</button>
        <button class="btn btnGhost" id="btnCopyAll">å¤åˆ¶å…¨æ–‡</button>
      </div>
      <div class="actions" style="margin-top:10px;">
        <button class="btn btnAccent" id="btnPublish">å‘å¸ƒç¬”è®°</button>
      </div>
      <div class="hint">
        æç¤ºï¼šå°çº¢ä¹¦ä¸æ”¯æŒç½‘é¡µç›´æ¥ä»£å‘ã€‚ç‚¹å‡»â€œä¿å­˜å›¾ç‰‡â€+â€œå¤åˆ¶å…¨æ–‡â€ï¼Œå†æ‰“å¼€å°çº¢ä¹¦ç²˜è´´å‘å¸ƒå³å¯ã€‚
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <div class="overlay" id="overlay">
    <div class="modal">
      <h3>ä¸‹ä¸€æ­¥æ€ä¹ˆå‘å¸ƒåˆ°å°çº¢ä¹¦ï¼Ÿ</h3>
      <p>1ï¼‰å…ˆç‚¹ä¸€æ¬¡ã€Œä¿å­˜å›¾ç‰‡ã€ä¿å­˜åˆ°ç›¸å†Œ<br/>2ï¼‰å†ç‚¹ã€Œå¤åˆ¶å…¨æ–‡ã€å¤åˆ¶æ–‡æ¡ˆ<br/>3ï¼‰æ‰“å¼€å°çº¢ä¹¦ â†’ å‘ç¬”è®° â†’ é€‰å›¾ç‰‡ â†’ ç²˜è´´æ–‡æ¡ˆ â†’ å‘å¸ƒ</p>
      <div class="mBtns">
        <button class="btn btnGhost" id="mClose">çŸ¥é“äº†</button>
        <button class="btn btnAccent" id="mCopy">å¤åˆ¶å…¨æ–‡</button>
      </div>
      <div class="small">å¦‚æœä½ è¦â€œæ›´æ‡’â€çš„ç‰ˆæœ¬ï¼šæˆ‘ä¹Ÿå¯ä»¥æŠŠè¿™æµç¨‹æ”¹æˆ WhatsApp/Telegram ç›´æ¥å‘å›¾æ›´é¡ºã€‚</div>
    </div>
  </div>

  <script>
    const toast = (msg) => {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(window.__t);
      window.__t = setTimeout(() => (t.style.display = 'none'), 1800);
    };

    // --- read params ---
    const params = new URLSearchParams(window.location.search);

    const qpTitle = (params.get('title') || '').trim();
    const qpCaption = (params.get('caption') || '').trim();
    const qpHashtagsRaw = (params.get('hashtags') || '').trim();

    // Support "tag1 tag2", "tag1,tag2", "#tag1 #tag2"
    const tags = qpHashtagsRaw
      ? qpHashtagsRaw
          .split(/[\s,]+/)
          .filter(Boolean)
          .map((t) => (t.startsWith('#') ? t : `#${t}`))
      : [];

    // Fill UI safely (no innerHTML from params)
    document.getElementById('title').value = qpTitle;
    document.getElementById('body').value = qpCaption;

    const chips = document.getElementById('chips');
    chips.innerHTML = '';
    for (const t of tags) {
      const d = document.createElement('div');
      d.className = 'chip';
      d.textContent = t;
      chips.appendChild(d);
    }

    // Optional image param
    const imageUrl = params.get('image') || document.getElementById('coverImg').src;
    document.getElementById('coverImg').src = imageUrl;

    // --- clipboard helpers ---
    async function copyToClipboard(text) {
      // Modern API (works on https + user gesture)
      if (navigator.clipboard && window.isSecureContext) {
        try {
          await navigator.clipboard.writeText(text);
          return true;
        } catch (e) {
          // fall through to legacy
        }
      }

      // Fallback for older browsers / some embedded webviews
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.setAttribute('readonly', '');
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, ta.value.length);

      let ok = false;
      try {
        ok = document.execCommand('copy');
      } catch (e) {
        ok = false;
      }
      document.body.removeChild(ta);
      return ok;
    }

    function buildFullText() {
      const title = document.getElementById('title').value.trim();
      const body = document.getElementById('body').value.trim();
      const hashtagsJoined = tags.join(' ').trim();

      // Format: Title\n\nBody\n\n#tags
      return [title, body, hashtagsJoined].filter(Boolean).join('\n\n');
    }

    // --- wire buttons ---
    const btnCopyAll = document.getElementById('btnCopyAll');
    const btnPublish = document.getElementById('btnPublish');
    const btnSaveImg = document.getElementById('btnSaveImg');

    const overlay = document.getElementById('overlay');
    const mClose = document.getElementById('mClose');
    const mCopy = document.getElementById('mCopy');

    btnCopyAll?.addEventListener('click', async () => {
      const ok = await copyToClipboard(buildFullText());
      toast(ok ? 'å·²å¤åˆ¶å…¨æ–‡ âœ…' : 'å¤åˆ¶å¤±è´¥ï¼šè¯·é•¿æŒ‰é€‰æ‹©å¤åˆ¶');
    });

    // Modal â€œcopyâ€
    mCopy?.addEventListener('click', async () => {
      const ok = await copyToClipboard(buildFullText());
      toast(ok ? 'å·²å¤åˆ¶å…¨æ–‡ âœ…' : 'å¤åˆ¶å¤±è´¥ï¼šè¯·é•¿æŒ‰é€‰æ‹©å¤åˆ¶');
    });

    // â€œPublishâ€ just shows instructions overlay
    btnPublish?.addEventListener('click', () => {
      overlay.style.display = 'flex';
    });

    mClose?.addEventListener('click', () => {
      overlay.style.display = 'none';
    });

    // Tap outside modal closes
    overlay?.addEventListener('click', (e) => {
      if (e.target === overlay) overlay.style.display = 'none';
    });

    // Click a hashtag chip to copy that single tag
    chips?.addEventListener('click', async (e) => {
      const el = e.target;
      if (el && el.classList && el.classList.contains('chip')) {
        const ok = await copyToClipboard(el.textContent.trim());
        toast(ok ? `å·²å¤åˆ¶ ${el.textContent}` : 'å¤åˆ¶å¤±è´¥');
      }
    });

    // Save Image button (optional: not implemented here)
    btnSaveImg?.addEventListener('click', () => {
      toast('ä¿å­˜å›¾ç‰‡ï¼šå¦‚éœ€è‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡ï¼Œæˆ‘å¯ä»¥åŠ  html2canvas å®ç°');
    });
  </script>

</body>
</html>
